<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <script src="https://kit.fontawesome.com/1f552ceadb.js" crossorigin="anonymous"></script>
    <title>Matches | Sumo League</title>
</head>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;500;600;700;800;900&display=swap');

    *,
    input {
        font-family: 'Albert Sans', sans-serif;
        font-weight: 500;
    }

    .extrabold {
        font-weight: 600;
    }

    .logo {
        margin: 0px 5px;
    }

    .topbar {
        font-family: 'Albert Sans', Arial;
        font-weight: 900;
    }

    .datetext {
        margin-bottom: 20px;
    }

    .topheight {
        height: 65px;
    }

    .notop {
        padding-top: 20px;
    }

    .sort-icon {
        margin: none;
        margin-left: 10px;
    }

    .no-bottom {
        padding-bottom: 0px;
    }

    .new-height {
        margin-top: 10px;
    }
    
    body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }

    #app {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }

    footer {
        margin-top: auto;
    }
</style>

<body onload="getData();">
    <div id="app">
    <nav class="navbar">
        <div class="container">
            <div class="navbar-brand topheight">
                <h1 class="title topheight"><a class="navbar-item has-text-danger extrabold topbar" href="index.html"><i
                            class="fa-solid fa-baby logo"></i>Sumo League</a></h1>
                <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false"
                    data-target="navbarBasicExample">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                </a>
            </div>
            <div id="navbarMenuHeroA" class="navbar-menu topheight">
                <div class="navbar-end">
                    <span class="navbar-item">
                        <a class="button is-dark is-inverted" href="index.html">
                            <span>Standings</span>
                        </a>
                    </span>
                    <span class="navbar-item">
                        <a class="button is-dark is-inverted" href="matches.html">
                            <span>Matches</span>
                        </a>
                    </span>
                    <span class="navbar-item">
                        <a class="button is-primary is-inverted" href="admin.html">
                            <span class="icon">
                                <i class="fa-solid fa-wrench"></i>
                            </span>
                            <span>Admin</span>
                        </a>
                    </span>
                </div>
            </div>
        </div>
    </nav>

    <section class="hero has-background-link-dark welcome is-small">
        <div class="hero-body">
            <div class="container has-text-centered">
                <div class="columns">
                    <div class="column is-6">
                        <div class="columns">
                            <div class="column is-offset-6">
                                <label class="has-text-white">Start date</label>
                                <input type="date" class="date date1 input has-text-centered" value="2022-11-13">
                            </div>
                        </div>
                    </div>
                    <div class="column is-6">
                        <div class="columns">
                            <div class="column is-6">
                                <label class="has-text-white">End date</label>
                                <input type="date" class="date date2 input has-text-centered" value="2022-11-21">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="columns">
                    <div class="column no-bottom">
                        <button class="button is-primary is-rounded" onclick="checkMatches();">Sort by dates<i
                                class="fa-solid fa-circle-chevron-right sort-icon"></i></button>
                        <div class="error is-center new-height"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="hero">
        <div class="hero-body notop">
            <nav class="pagination is-rounded is-centered" role="navigation" aria-label="pagination">
                <ul class="pagination-list">
                    <li>
                        <a class="pagination-link max-left" onclick="setPage(1);" disabled><i
                                class="fa-solid fa-caret-left"></i><i class="fa-solid fa-caret-left"></i></a>
                    </li>
                    <li>
                        <a class="pagination-previous" onclick="backPage();" disabled><i
                                class="fa-solid fa-caret-left"></i></a>
                    </li>
                    <li>
                        <a class="pagination-next" onclick="nextPage();"><i class="fa-solid fa-caret-right"></i></a>
                    </li>
                    <li>
                        <a class="pagination-link max-right"><i class="fa-solid fa-caret-right"></i><i
                                class="fa-solid fa-caret-right"></i></a>
                    </li>
                </ul>
            </nav>
            <div class="columns is-multiline games-list"></div>
        </div>
    </section>
    <footer class="footer">
        <div class="content has-text-centered">
            <p>
                <strong>Sumo League</strong><br>Copyright <a href="https://michaelgee.stefanoesposto.com">Michael
                    Gee</a> 2022
            </p>
        </div>
    </footer>
</div>
</body>
<script>
    let gameData;
    let sumoData;
    let startId = 0;
    let currentPage = 1;
    let isSorted = false;
    let date1;
    let date2;
    
    let counter = 0;

    function getData() {
        gameData = JSON.parse(localStorage['games']);
        sumoData = JSON.parse(localStorage['sumo']);
    }

    gameData = JSON.parse(localStorage.getItem('games'));
    sumoData = JSON.parse(localStorage.getItem('sumo'));

    createTable();

    function checkMatches() {
        date1Val = document.querySelector('.date1');
        date2Val = document.querySelector('.date2');
        let error = document.createElement('p');
        error.setAttribute("class", "help is-danger is-centered");
        let buttonText = document.querySelector('.error');
        buttonText.replaceChildren();
        if (date1Val.value > date2Val.value || date1Val.value == null || date2Val.value == null) {
            error.textContent = "Invalid dates!";
            buttonText.appendChild(error);
        } else {
            isSorted = true;
            currentPage = 1;
            startId = 0;
            date1 = date1Val.value;
            date2 = date2Val.value;
            createTable();
        }
    }

    function createTable() {
        if (!isSorted) {
            date1 = "0000-00-00";
            date2 = "9999-99-99"
        }
        counter = 0;
        const table = document.querySelector(".games-list");
        table.replaceChildren();
        gameNum = 0;
        gameData.forEach((game) => {
            if (game.date >= date1 && game.date <= date2) {
                if (gameNum < 8 && counter >= startId) {
                    let div = document.createElement('div');
                    div.classList.add('column', 'is-6');

                    let article = document.createElement('article');
                    article.classList.add('box');

                    let date = document.createElement('p');
                    date.classList.add('has-text-weight-light', 'datetext');
                    date.textContent = getDate(game.date);

                    let columns = document.createElement('div');
                    columns.classList.add('columns');
                    let columnEast = document.createElement('div');
                    columnEast.classList.add('column', 'has-text-left');
                    let columnWest = document.createElement('div');
                    columnWest.classList.add('column', 'has-text-right');

                    let textEast = document.createElement('p');
                    textEast.textContent = "EAST";
                    textEast.classList.add('subtitle');
                    let textWest = document.createElement('p');
                    textWest.textContent = "WEST";
                    textWest.classList.add('subtitle');

                    let eastSpan = document.createElement('span');
                    eastSpan.classList.add('is-pulled-right');
                    let westSpan = document.createElement('span');
                    westSpan.classList.add('is-pulled-left');

                    let sumo = sumoData.filter(sumo => sumo.id == game.east);
                    let east = document.createElement('a');
                    east.classList.add('title');
                    east.textContent = sumo[0].surname;
                    east.href = 'sumos.html?id=' + sumo[0].id;
                    eastSpan.appendChild(east);

                    sumo = sumoData.filter(sumo => sumo.id == game.west);
                    let west = document.createElement('a');
                    west.classList.add('title');
                    west.textContent = sumo[0].surname;
                    west.href = 'sumos.html?id=' + sumo[0].id;
                    westSpan.appendChild(west);

                    let trophy = document.createElement('i');
                    trophy.classList.add('fa-solid', 'fa-trophy', 'has-text-success');

                    if (game.winner == "east") {
                        columnEast.classList.add('has-background-success-light');
                        textEast.classList.add('has-text-success');
                        eastSpan.appendChild(trophy);
                    } else {
                        columnWest.classList.add('has-background-success-light');
                        textWest.classList.add('has-text-success');
                        westSpan.appendChild(trophy);
                    }

                    columnEast.appendChild(eastSpan);
                    columnWest.appendChild(westSpan);

                    columnEast.appendChild(textEast);
                    columnEast.appendChild(east);
                    columnWest.appendChild(textWest);
                    columnWest.appendChild(west);

                    columns.appendChild(columnEast);
                    columns.appendChild(columnWest);
                    article.appendChild(date);
                    article.appendChild(columns);
                    div.appendChild(article);
                    table.appendChild(div);
                    gameNum++;
                }
                counter++;
            }
        })
        createPagination();
    }

    function createPagination() {
        numGames = 0;
        gameData.forEach((game) => {
            if (game.date >= date1 && game.date <= date2){
                numGames++;
            }
        })

        const gamesList = document.querySelector('.games-list');
        const list = document.querySelector('.pagination-list');
        const maxMaxPage = Math.ceil(gameData.length / 8);
        const next = document.querySelector('.pagination-next');
        const maxRight = document.querySelector('.max-right');
        let maxPage = Math.ceil(numGames / 8);

        maxRight.setAttribute('onclick', 'setPage(' + maxPage + ', gameData);');       

        if (maxPage == 0){
            let column = document.createElement('column');
            let p = document.createElement('p');

            p.classList.add("help", "is-danger");
            p.textContent = "No games found";

            column.appendChild(p);
            column.classList.add('has-text-centered');

            gamesList.replaceChildren();
            gamesList.classList.add('is-centered');
            gamesList.appendChild(column);
            maxPage = 1;
        } else if (maxPage == 1){
            next.setAttribute('disabled', '');
            maxRight.setAttribute('disabled', '');
            gamesList.classList.remove('is-centered');
        } else if (currentPage == 1){
            next.removeAttribute('disabled');
            maxRight.removeAttribute('disabled');
            gamesList.classList.remove('is-centered');
        }
        
        for (let page = maxMaxPage; page > 0; page--) {
            let previous = document.querySelector('#page-' + page);
            if (previous != null) {
                previous.remove();
            }
        }

        for (let page = maxPage; page > 0; page--) {
            let li = document.createElement('li');
            let a = document.createElement('a');

            a.classList.add('pagination-link', 'page-index');
            a.id = "page-" + page;
            a.setAttribute('onclick', 'setPage(' + page + ', gameData);');
            a.textContent = page;

            if (page == currentPage) {
                a.classList.add('is-current');
            } else {
                a.classList.remove('is-current');
            }

            li.appendChild(a);
            list.insertBefore(li, list.children[2]);
        }
    }

    function nextPage() {
        numGames = 0;
        gameData.forEach((game) => {
            if (game.date >= date1 && game.date <= date2){
                numGames++;
            }
        })
        startId += 8;
        if (startId > numGames) {
            startId = numGames - (numGames % 8);           
        }
        if (startId + 8 >= numGames) {
            document.querySelector(".pagination-next").setAttribute("disabled", "");
            document.querySelector(".max-left").removeAttribute("disabled", "");
            document.querySelector(".max-right").setAttribute("disabled", "");
        }
        if (startId <= numGames) {
            document.querySelector(".pagination-previous").removeAttribute("disabled", "");
            document.querySelector(".max-left").removeAttribute("disabled", "");
            console.log("4");
            if (currentPage < numGames / 8) {
                currentPage++;
            }
            createTable();
        }
    }

    function backPage() {
        startId -= 8;
        if (startId < 0) {
            startId = 0;
        }
        if (startId - 8 < 0) {
            document.querySelector(".pagination-previous").setAttribute("disabled", "");
            document.querySelector(".max-left").setAttribute("disabled", "");
            document.querySelector(".max-right").removeAttribute("disabled", "");
        }
        if (startId >= 0) {
            document.querySelector(".pagination-next").removeAttribute("disabled", "");
            document.querySelector(".max-right").removeAttribute("disabled", "");
            if (currentPage > 1) {
                currentPage--;
            };
            createTable(date1, date2);
        }
    }

    function setPage(page, date1, date2) {
        let maxPage = Math.ceil(gameData.length / 8);
        startId = (page - 1) * 8;
        currentPage = page;
        if (page == 1) {
            document.querySelector(".pagination-previous").setAttribute("disabled", "");
            document.querySelector(".pagination-next").removeAttribute("disabled", "");
            document.querySelector(".max-left").setAttribute("disabled", "");
            document.querySelector(".max-right").removeAttribute("disabled", "");
        } else if (page == maxPage) {
            document.querySelector(".pagination-previous").removeAttribute("disabled", "");
            document.querySelector(".pagination-next").setAttribute("disabled", "");
            document.querySelector(".max-left").removeAttribute("disabled", "");
            document.querySelector(".max-right").setAttribute("disabled", "");
        } else {
            document.querySelector(".pagination-next").removeAttribute("disabled", "")
            document.querySelector(".pagination-previous").removeAttribute("disabled", "");
            document.querySelector(".max-left").removeAttribute("disabled", "");
            document.querySelector(".max-right").removeAttribute("disabled", "");
        }
        createTable(date1, date2);
    }

    function getDate(date) {
        let final = "";
        if (date.substring(5, 7) == "01") {
            final += "Jan. ";
        } else if (date.substring(5, 7) == "02") {
            final += "Feb. ";
        } else if (date.substring(5, 7) == "03") {
            final += "Mar. ";
        } else if (date.substring(5, 7) == "04") {
            final += "Apr. ";
        } else if (date.substring(5, 7) == "05") {
            final += "May ";
        } else if (date.substring(5, 7) == "06") {
            final += "Jun. ";
        } else if (date.substring(5, 7) == "07") {
            final += "Jul. ";
        } else if (date.substring(5, 7) == "08") {
            final += "Aug. ";
        } else if (date.substring(5, 7) == "09") {
            final += "Sep. ";
        } else if (date.substring(5, 7) == "10") {
            final += "Oct. ";
        } else if (date.substring(5, 7) == "11") {
            final += "Nov. ";
        } else if (date.substring(5, 7) == "12") {
            final += "Dec. ";
        }
        return final + date.substring(8, 10) + ", " + date.substring(0, 4);
    }
</script>

</html>