<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <script src="https://kit.fontawesome.com/1f552ceadb.js" crossorigin="anonymous"></script>
    <title>Sumo Profile | Sumo League</title>
</head>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@100;300;400;500;700;800;900&display=swap');

    * {
        font-family: 'Manrope', sans-serif;
        font-weight: 500;
    }

    .extrabold {
        font-weight: 800;
    }

    .bigger {
        font-size: 40px;
    }
</style>

<body onload="start();">
    <nav class="navbar" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <h1 class="title"><a class="navbar-item has-text-danger extrabold" href="index.html">Sumo League</a></h1>

            <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false"
                data-target="navbarBasicExample">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>

        <div id="navbarBasicExample" class="navbar-menu">
            <div class="navbar-start">
                <a class="navbar-item" href="wrestlers.html">
                    Wrestlers
                </a>

                <a class="navbar-item" href="matches.html">
                    Matches
                </a>

                <div class="navbar-item has-dropdown is-hoverable">
                    <a class="navbar-link">
                        More
                    </a>
                    <div class="navbar-dropdown">
                        <a class="navbar-item" href="admin.html">
                            Admin Page
                        </a>
                    </div>
                </div>
            </div>
    </nav>

    <section class="hero is-info welcome is-small">
        <div class="hero-body">
            <div class="container">
                <h1 class="title" id="name">
                </h1>
            </div>
        </div>
    </section>
    <div>
        <section class="hero">
            <div class="hero-body">
                <section class="info-tiles">
                    <div class="tile is-ancestor has-text-centered">
                        <div class="tile is-parent">
                            <article class="tile is-child box">
                                <p class="subtitle">Sumo Name</p>
                                <p class="title" id="sumo-name"></p>
                            </article>
                        </div>
                        <div class="tile is-parent">
                            <article class="tile is-child box">
                                <p class="subtitle">Wins - Losses</p>
                                <p class="title bigger" id="win-loss"></p>
                            </article>
                        </div>
                        <div class="tile is-parent">
                            <article class="tile is-child box">
                                <p class="subtitle">Rank</p>
                                <p class="title" id="rank"></p>
                            </article>
                        </div>
                        <div class="tile is-parent">
                            <article class="tile is-child box">
                                <p class="subtitle">Height</p>
                                <p class="title bigger" id="height"></p>
                            </article>
                        </div>
                    </div>
                    <div class="tile is-ancestor has-text-centered">
                        <div class="tile is-parent">
                            <article class="tile is-child box">
                                <p class="subtitle">Real Name</p>
                                <p class="title" id="real-name"></p>
                            </article>
                        </div>
                        <div class="tile is-parent">
                            <article class="tile is-child box">
                                <p class="subtitle">Win Percent</p>
                                <p class="title bigger" id="win-percent"></p>
                            </article>
                        </div>
                        <div class="tile is-parent">
                            <article class="tile is-child box">
                                <p class="subtitle">Stable</p>
                                <p class="title" id="stable"></p>
                            </article>
                        </div>
                        <div class="tile is-parent">
                            <article class="tile is-child box">
                                <p class="subtitle">Weight</p>
                                <p class="title bigger" id="weight"></p>
                            </article>
                        </div>
                    </div>
                </section>
            </div>
        </section>
    </div>
    <section class="hero is-info welcome is-small">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">
                    Matches
                </h1>
            </div>
        </div>
    </section>
    <section class="hero">
        <div class="hero-body">
            <table class="table is-striped is-9" id="games">
                <thead>
                    <tr>
                        <th class="extrabold">Date</th>
                        <th class="extrabold">East</th>
                        <th class="extrabold">West</th>
                        <th class="extrabold">Won?</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </section>
</body>
<script>
    function start() {
        const dataString = localStorage.getItem('sumo');
        const gameData = localStorage.getItem('games');

        const sumos = JSON.parse(dataString);
        const games = JSON.parse(gameData);

        let params = (new URL(document.location)).searchParams;
        const sumo = sumos.filter(sumo => sumo.id == params.get('id'));
        let tableBody = document.querySelector('#standings tbody');

        document.querySelector('#name').textContent = sumo[0].surname + " " + sumo[0].firstname;
        document.querySelector('#sumo-name').textContent = document.querySelector('#name').textContent;
        document.querySelector('#real-name').textContent = sumo[0].name;
        document.querySelector('#win-loss').textContent = sumo[0].w + " - " + sumo[0].l;
        document.querySelector('#rank').textContent = sumo[0].rank;
        document.querySelector('#win-percent').textContent = Math.round((sumo[0].w / (parseInt(sumo[0].w) + parseInt(sumo[0].l)) * 100) * 10) / 10 + "%";
        document.querySelector('#stable').textContent = sumo[0].stable + " Stable";
        document.querySelector('#height').textContent = sumo[0].height;
        document.querySelector('#weight').textContent = sumo[0].weight;

        createTable(sumos, sumo, games);
    }

    function createTable(sumos, sumo, games) {
        let gameBody = document.querySelector('#games tbody');
        gameBody.replaceChildren();

        games.forEach((game) => {
            if (game.east == sumo[0].id || game.west == sumo[0].id) {
                addGame(sumos, sumo, game, gameBody);
            }
        });
    }

    function addGame(sumos, sumo, game, gameBody) {
        const row = document.createElement('tr');
        let td = document.createElement('td');
        let link1 = document.createElement('a');
        let link2 = document.createElement('a');
        let winIcon = document.createElement('i');
        winIcon.classList.add("fa-solid");
        winIcon.classList.add("fa-trophy");
        let loseIcon = document.createElement('i');
        loseIcon.classList.add("fa-solid");
        loseIcon.classList.add("fa-circle-xmark");

        td.textContent = game.date;
        row.appendChild(td);

        td = document.createElement('td');
        //let sumo = sumoData.filter(sumo => sumo.id == game.east);
        link1.href = 'sumos.html?id=' + game.east;            
        link1.textContent = sumos[game.east - 1].surname;
        td.appendChild(link1);
        row.appendChild(td);
        

        td = document.createElement('td');
        //sumo = sumoData.filter(sumo => sumo.id == game.west);
        link2.href = 'sumos.html?id=' + game.west;
        link2.textContent = sumos[game.west - 1].surname;
        td.appendChild(link2);
        row.appendChild(td); 

        td = document.createElement('td');
        td.classList.add("has-text-centered");
        if (game.winner == "east" && game.east == sumo[0].id || game.winner == "west" && game.west == sumo[0].id) {
            td.appendChild(winIcon);
        } else {
            td.appendChild(loseIcon);
        }
        row.appendChild(td);
          
        gameBody.appendChild(row);
    }

</script>

</html>