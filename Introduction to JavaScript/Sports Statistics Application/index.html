<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <script src="https://kit.fontawesome.com/1f552ceadb.js" crossorigin="anonymous"></script>
    <title>Home | Sumo League</title>
</head>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;500;600;700;800;900&display=swap');

    * {
        font-family: 'Albert Sans', sans-serif;
        font-weight: 500;
    }

    .extrabold {
        font-weight: 600;
    }

    .fullheight {
        height: 500px;
    }

    .logo {
        margin: 0px 5px;
    }

    .topbar {
        font-family: 'Albert Sans', Arial;
        font-weight: 900;
    }

    .topheight {
        height: 65px;
    }
    
</style>

<body onload="getData();">
    <nav class="navbar">
        <div class="container">
            <div class="navbar-brand topheight">
                <h1 class="title topheight"><a class="navbar-item has-text-danger extrabold topbar" href="index.html"><i class="fa-solid fa-baby logo"></i>Sumo League</a></h1>
                <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false"
                    data-target="navbarBasicExample">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                </a>
            </div>
          <div id="navbarMenuHeroA" class="navbar-menu topheight">
            <div class="navbar-end">
              <span class="navbar-item">
                <a class="button is-dark is-inverted" href="index.html">
                  <span>Home</span>
                </a>
              </span>
              <span class="navbar-item">
                <a class="button is-dark is-inverted" href="wrestlers.html">
                  <span>Wrestlers</span>
                </a>
              </span>
              <span class="navbar-item">
                <a class="button is-dark is-inverted" href="matches.html">
                  <span>Matches</span>
                </a>
              </span>
              <span class="navbar-item">
                <a class="button is-primary is-inverted" href="admin.html">
                  <span class="icon">
                    <i class="fa-solid fa-wrench"></i>
                  </span>
                  <span>Admin</span>
                </a>
              </span>
            </div>
          </div>
        </div>
    </nav>

    <section class="hero is-info welcome is-small">
        <div class="hero-body">
            <div class="container has-text-centered">
                <h1 class="title">
                    Standings
                </h1>
            </div>
        </div>
    </section>
    <div>
        <section class="hero">
            <div class="hero-body">
                <div class="box fullheight">
                    <div class="table-container">
                <table class="table is-striped is-9 is-fullwidth" id="standings">
                    <thead>
                        <tr>
                            <th onclick="sort('Rank')" class="extrabold">Rank</th>
                            <th onclick="sort('Surname')" class="extrabold">Name</th>
                            <th onclick="sort('Name')" class="extrabold">Real Name</th>
                            <th onclick="sort('Wins')" class="extrabold">W</th>
                            <th onclick="sort('Losses')" class="extrabold">L</th>
                            <th onclick="sort('Rate')" class="extrabold">Win Rate</th>
                            <th onclick="sort('Stable')" class="extrabold">Stable</th>
                            <th onclick="sort('Height')" class="extrabold">Height</th>
                            <th onclick="sort('Weight')" class="extrabold">Weight</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
        <nav class="pagination is-rounded is-centered" role="navigation" aria-label="pagination">
                    <ul class="pagination-list">
                        <li>
                            <a class="pagination-link max-left" onclick="setPage(1);" disabled><i class="fa-solid fa-caret-left"></i><i class="fa-solid fa-caret-left"></i></a>
                        </li>
                        <li>
                            <a class="pagination-previous" onclick="backPage();" disabled><i class="fa-solid fa-caret-left"></i></a>
                        </li>
                        <li>
                            <a class="pagination-link is-current" id="page1" onclick="setPage(1);">1</a>
                        </li>
                        <li>
                            <a class="pagination-link" id="page2" onclick="setPage(2);">2</a>
                        </li>
                        <li>
                            <a class="pagination-link" id="page3" onclick="setPage(3);">3</a>
                        </li>
                        <li>
                            <a class="pagination-link" id="page4" onclick="setPage(4);">4</a>
                        </li>
                        <li>
                            <a class="pagination-next" onclick="nextPage();"><i class="fa-solid fa-caret-right"></i></a>
                        </li>
                        <li>
                            <a class="pagination-link max-right" onclick="setPage(4);"><i class="fa-solid fa-caret-right"></i><i class="fa-solid fa-caret-right"></i></a>
                        </li>
                    </ul>
                </nav>
            </div>
        </section>
    </div>

</body>
<script>
    let sumoData;
    let currentSort = "none";
    let startId = 0;
    let currentPage = 1;

    function getData() {
        sumoData = JSON.parse(localStorage['sumo']);
    }

    sumoData = JSON.parse(localStorage.getItem('sumo'));
    createTable(sumoData);
    sortData();

    function createTable(sumoData) {
        let tableBody = document.querySelector('#standings tbody');
        tableBody.replaceChildren();
        let counter = startId + 10;
        let currentPageId = "page" + currentPage;
        if (document.querySelector(".is-current").id !== currentPageId) {
            document.querySelector(".is-current").classList.remove("is-current");
            document.querySelector("#" + currentPageId).classList.add("is-current");
        }

        sumoData.forEach((sumo) => {
            if (sumoData.indexOf(sumo) >= startId) {
                if (counter > startId) {
                    const row = document.createElement('tr');
                    let td = document.createElement('td');
                    let link = document.createElement('a');

                    td.textContent = sumo.rank;
                    row.appendChild(td);

                    td = document.createElement('td');
                    link.href = 'sumos.html?id=' + sumo.id;
                    link.textContent = sumo.surname;
                    td.appendChild(link);
                    row.appendChild(td);

                    td = document.createElement('td');
                    td.textContent = sumo.name;
                    row.appendChild(td);

                    td = document.createElement('td');
                    td.textContent = sumo.w;
                    row.appendChild(td);

                    td = document.createElement('td');
                    td.textContent = sumo.l;
                    row.appendChild(td);

                    td = document.createElement('td');
                    td.textContent = (Math.round((sumo.w / (parseInt(sumo.w) + parseInt(sumo.l)) * 100) * 10) / 10 + "%");
                    row.appendChild(td);

                    td = document.createElement('td');
                    td.textContent = sumo.stable;
                    row.appendChild(td);

                    td = document.createElement('td');
                    td.textContent = sumo.height;
                    row.appendChild(td);

                    td = document.createElement('td');
                    td.textContent = sumo.weight;
                    row.appendChild(td);

                    tableBody.appendChild(row);
                    counter--;
                }
            }
        });
    }

    function sort(field) {
        if (field === 'Surname') {
            if (currentSort === 'surname') {
                sumoData = sumoData.sort((teamA, teamB) => {
                    if (teamA.surname.substring(0, 1) == "Ō") {
                        teamA.surname = "O" + teamA.surname.substring(1);
                    } else if (teamB.surname.substring(0, 1) == "Ō") {
                        teamB.surname = "O" + teamB.surname.substring(1);
                    }
                    console.log(teamA.surname);
                    return (teamA.surname > teamB.surname) ? -1 : 1;
                });
                currentSort = 'none';
            } else {
                sumoData = sumoData.sort((teamA, teamB) => {
                    if (teamA.surname.substring(0, 1) == "Ō") {
                        teamA.surname = "O" + teamA.surname.substring(1);
                    } else if (teamB.surname.substring(0, 1) == "Ō") {
                        teamB.surname = "O" + teamB.surname.substring(1);
                    }
                    return (teamA.surname < teamB.surname) ? -1 : 1;
                });
                currentSort = 'surname';
            }
        } else if (field === 'Name') {
            if (currentSort === 'name') {
                sumoData = sumoData.sort((teamA, teamB) => {
                    return (teamA.name > teamB.name) ? -1 : 1;
                });
                currentSort = 'none';
            } else {
                sumoData = sumoData.sort((teamA, teamB) => {
                    return (teamA.name < teamB.name) ? -1 : 1;
                });
                currentSort = 'name';
            }
        } else if (field === 'Wins') {
            if (currentSort === 'wins') {
                sumoData = sumoData.sort((teamA, teamB) => teamA.w - teamB.w);
                currentSort = 'none';
            } else {
                sumoData = sumoData.sort((teamA, teamB) => teamB.w - teamA.w);
                currentSort = 'wins';
            }
        } else if (field === 'Losses') {
            if (currentSort === 'losses') {
                sumoData = sumoData.sort((teamA, teamB) => teamA.l - teamB.l);
                currentSort = 'none';
            } else {
                sumoData = sumoData.sort((teamA, teamB) => teamB.l - teamA.l);
                currentSort = 'losses';
            }
        } else if (field === 'Rate') {
            if (currentSort === 'rate') {
                sumoData = sumoData.sort((teamA, teamB) => (teamA.w / (parseInt(teamA.w) + parseInt(teamA.l))) - (teamB.w / (parseInt(teamB.w) + parseInt(teamB.l))));
                currentSort = 'none';
            } else {
                sumoData = sumoData.sort((teamA, teamB) => (teamB.w / (parseInt(teamB.w) + parseInt(teamB.l))) - (teamA.w / (parseInt(teamA.w) + parseInt(teamA.l))));
                currentSort = 'rate';
            }
        } else if (field === 'Rank') {
            if (currentSort === 'rank') {
                sumoData = sumoData.sort((teamA, teamB) => teamA.rankNum - teamB.rankNum);
                currentSort = 'none';
            } else {
                sumoData = sumoData.sort((teamA, teamB) => teamB.rankNum - teamA.rankNum);
                currentSort = 'rank';
            }
        } else if (field === 'Stable') {
            if (currentSort === 'stable') {
                sumoData = sumoData.sort((teamA, teamB) => {
                    return (teamA.stable > teamB.stable) ? -1 : 1;
                });
                currentSort = 'none';
            } else {
                sumoData = sumoData.sort((teamA, teamB) => {
                    return (teamA.stable < teamB.stable) ? -1 : 1;
                });
                currentSort = 'stable';
            }
        } else if (field === 'Height') {
            if (currentSort === 'height') {
                sumoData = sumoData.sort((teamA, teamB) => {
                    return (parseFloat(teamA.height.substring(0, 1) * 12) + parseFloat(teamA.height.substring(4, teamA.height.indexOf(".") + 2)) > parseFloat(teamB.height.substring(0, 1) * 12) + parseFloat(teamB.height.substring(4, teamB.height.indexOf(".") + 2))) ? -1 : 1;
                });
                currentSort = 'none';
            } else {
                sumoData = sumoData.sort((teamA, teamB) => {
                    return (parseFloat(teamA.height.substring(0, 1) * 12) + parseFloat(teamA.height.substring(4, teamA.height.indexOf(".") + 2)) < parseFloat(teamB.height.substring(0, 1) * 12) + parseFloat(teamB.height.substring(4, teamB.height.indexOf(".") + 2))) ? -1 : 1;
                });
                currentSort = 'height';
            }
        } else if (field === 'Weight') {
            if (currentSort === 'weight') {
                sumoData = sumoData.sort((teamA, teamB) => {
                    return (parseFloat(teamA.weight.substring(0, 5))) > (parseFloat(teamB.weight.substring(0, 5))) ? -1 : 1;
                });
                currentSort = 'none';
            } else {
                sumoData = sumoData.sort((teamA, teamB) => {
                    return (parseFloat(teamA.weight.substring(0, 5))) < (parseFloat(teamB.weight.substring(0, 5))) ? -1 : 1;
                });
                currentSort = 'weight';
            }
        }
        createTable(sumoData);
    }

    function sortData() {
        currentSort = 'rank'
        sort('Rank');
        console.log("hi");
    }

    function nextPage() {
        startId += 10;
        if (startId > sumoData.length) {
            startId = sumoData.length - (sumoData.length % 10);
        }
        if (startId + 10 >= sumoData.length) {
            document.querySelector(".pagination-next").setAttribute("disabled", "");
            document.querySelector(".max-left").removeAttribute("disabled", "");
            document.querySelector(".max-right").setAttribute("disabled", "");
        }
        if (startId < sumoData.length) {
            document.querySelector(".pagination-previous").removeAttribute("disabled", "");
            document.querySelector(".max-left").removeAttribute("disabled", "");
            if (currentPage < sumoData.length / 10) {
                currentPage++;
            }
            createTable(sumoData);
        }
    }

    function backPage() {
        startId -= 10;
        if (startId < 0) {
            startId = 0;
        }
        if (startId - 10 < 0) {
            document.querySelector(".pagination-previous").setAttribute("disabled", "");
            document.querySelector(".max-left").setAttribute("disabled", "");
            document.querySelector(".max-right").removeAttribute("disabled", "");
        }
        if (startId >= 0) {
            document.querySelector(".pagination-next").removeAttribute("disabled", "");
            document.querySelector(".max-right").removeAttribute("disabled", "");
            if (currentPage > 1) {
                currentPage--;
            };
            createTable(sumoData);
        }
    }

    function setPage(page) {
        startId = (page - 1) * 10;
        currentPage = page;
        if (page == 1) {
            document.querySelector(".pagination-previous").setAttribute("disabled", "");
            document.querySelector(".pagination-next").removeAttribute("disabled", "");
            document.querySelector(".max-left").setAttribute("disabled", "");
            document.querySelector(".max-right").removeAttribute("disabled", "");
        } else if (page == 4) {
            document.querySelector(".pagination-previous").removeAttribute("disabled", "");
            document.querySelector(".pagination-next").setAttribute("disabled", "");
            document.querySelector(".max-left").removeAttribute("disabled", "");
            document.querySelector(".max-right").setAttribute("disabled", "");
        } else {
            document.querySelector(".pagination-next").removeAttribute("disabled", "")
            document.querySelector(".pagination-previous").removeAttribute("disabled", "");
            document.querySelector(".max-left").removeAttribute("disabled", "");
            document.querySelector(".max-right").removeAttribute("disabled", "");
        }
        createTable(sumoData);
    }
</script>

</html>